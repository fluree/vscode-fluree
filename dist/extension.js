(()=>{"use strict";var e={530:(e,t,n)=>{var o=n(315);e.exports=function(e,t){return/^\/\//.test(e)&&(e="https:"+e),o.call(this,e,t)},global.fetch||(global.fetch=e.exports,global.Response=o.Response,global.Headers=o.Headers,global.Request=o.Request)},56:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.hasApiKey=t.fetchMigrations=t.checkExitPromise=t.sendReq=t.getCurrentSelection=t.getConfigFile=void 0;const o=n(147),r=n(496),i=n(530);function s(e){return e.json().then((function(t){return Object.assign(e,{json:t})})).catch((e=>{let t=e.message||e;r.window.showErrorMessage(JSON.stringify(t))}))}function a(e){let t;return e.filter((e=>e.block>1&&e.asserted[0])).sort(((e,t)=>e.block-t.block)).reduce(((e,n)=>{const o=n.asserted.map((e=>(t[e._id]?e._id=t[e._id]:(t[e._id]=Object.keys(e).some((e=>/^_collection/.test(e)))?["_collection/name",e["_collection/name"]]:["_predicate/name",e["_predicate/name"]],e._id=Object.keys(e).some((e=>/^_collection/.test(e)))?"_collection":"_predicate"),e)));return e[n.block]?e[n.block]=[...e[n.block],...o]:e[n.block]=o,e}),{})}t.hasApiKey=function(e){return void 0!==e&&0!==e.length},t.getConfigFile=function(e){let t=e[0].path;return r.workspace.openTextDocument(t).then((e=>{const t=e.getText(),n=JSON.parse(t),{network:o,db:r,ip:i,apiKey:s}=n})),{network:"",db:"",ip:"",apiKey:""}},t.getCurrentSelection=function(){const e=r.window.activeTextEditor;if(e){const t=e.selection;return e.document.getText(t)}},t.sendReq=async function(e,t,n,o={}){const a={headers:{"content-type":"application/json",...o},method:"POST",body:t};return console.log("fetching: ",`${e}: ${JSON.stringify(a)}`),i(e,a).then((e=>s(e))).then((e=>(console.log("response in fetch: ",e.json),e.json))).then((e=>e)).then((e=>{let t=e.status;return console.log(t),"db/invalid-action"===e.error?r.window.showInformationMessage(` Are you using a version of Fluree that supports this endpoint? ${t?`Status: ${t}`:""}. Check flureeResponse.txt`):e})).catch((e=>{let t=e.message||e;console.log("error: ",e),r.window.showErrorMessage(JSON.stringify(t))}))},t.checkExitPromise=function(e,t){if(void 0===e)throw new Error(`The user exited ${t}`);return!0},t.fetchMigrations=function(e,t,n={}){return function(e,t={}){return i(`${e}/query`,{method:"POST",headers:{"content-type":"application/json",...t},body:JSON.stringify({selectDistinct:"?s",where:[{union:[[["?s","rdf:type","_collection"]],[["?s","rdf:type","_predicate"]]]}],opts:{limit:9999}})}).then((e=>s(e))).then((e=>e.json))}(e,n).then((t=>async function(e,t){if(e.error)throw new Error(e.message||e.error);const n=e.map((e=>()=>function(e,t){return i(`${e}/history`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({history:t,prettyPrint:!0})}).then((e=>e.json())).catch((e=>{throw e}))}(t,e)));let o=0;const r=[];for(;n.length>o;){const e=await Promise.all(n.slice(o,o+20).map((e=>e())));r.push(...e.flat()),o+=20}return r}(t,e))).then(a).then((e=>function(e,t){return new Promise(((n,r)=>{o.mkdirSync(`${t}/migrations`,{recursive:!0}),n(e)}))}(e,t))).then((e=>function(e,t){return Object.keys(e).forEach((async(n,r)=>{await o.writeFile(`${t}/migrations/${String(r).padStart(5,"0")}.json`,JSON.stringify(e[n]),(e=>{if(e)throw e}))})),r.window.showInformationMessage("Success. Check migrations/ in your root directory")}(e,t))).catch((e=>{let t=e.message||e;return r.window.showErrorMessage(JSON.stringify(t))}))}},496:e=>{e.exports=require("vscode")},315:e=>{e.exports=require("node-fetch")},147:e=>{e.exports=require("fs")}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,n),i.exports}var o={};(()=>{var e=o;Object.defineProperty(e,"__esModule",{value:!0}),e.deactivate=e.activate=void 0;const t=n(496),r=n(56),i=e=>t.workspace.openTextDocument({language:"json",content:JSON.stringify(e,null,2)}).then((e=>t.window.showTextDocument(e)));e.activate=async function(e){let n={},o=t.workspace.rootPath||"",s=t.commands.registerCommand("extension.setTestConfig",(()=>{n={ip:"http://localhost:8090",network:"test",db:"test"}})),a=t.commands.registerCommand("extension.setConfig",(()=>{t.workspace.findFiles("flureeConfig.json",null,1).then((e=>{if(0===e.length){let e={};return t.window.showInputBox({prompt:"No 'flureeConfig.json' found. Please input the IP address where your db is running. For example: http://localhost:8090: ",value:"IP"}).then((n=>{if(n)return e.ip=n,t.window.showInputBox({prompt:"Please input the network your database is in: ",value:"Network"})})).then((n=>{if(n)return e.network=n,t.window.showInputBox({prompt:"Please input your database name: ",value:"Database"})})).then((n=>{if(n)return e.db=n,t.window.showInputBox({prompt:"Please input your api key if using Nexus: "})})).then((t=>t?(e.apiKey=t,e):e))}return(0,r.getConfigFile)(e)})).then((e=>{void 0!==e&&(n=e)})).then((e=>t.window.showInformationMessage("Config set. Network: "+n.network+" Db: "+n.db+" IP: "+n.ip+" apiKey: "+(n.apiKey||""))))})),c=t.commands.registerCommand("extension.getConfig",(()=>{t.window.showInformationMessage("Config. Network: "+n.network+" Db: "+n.db+" IP: "+n.ip+" apiKey: "+(n.apiKey||""))})),l=t.commands.registerCommand("extension.submitTransaction",(()=>{if(0!==Object.keys(n).length){let e=(0,r.getCurrentSelection)()||"",t=`${n.ip}/fdb/${n.network}/${n.db}/transact`,s={};return(0,r.hasApiKey)(n.apiKey)&&(s={authorization:`Bearer ${n.apiKey}`}),(0,r.sendReq)(t,e,o,s).then((e=>i(e))).catch((e=>console.log("error: ",e)))}t.window.showErrorMessage("Please connect to a database first. `Fluree: Set Config`")})),u=t.commands.registerCommand("extension.submitQuery",(()=>{if(0===Object.keys(n).length)t.window.showErrorMessage("Please connect to a database first. `Fluree: Set Config`");else{let e=(0,r.getCurrentSelection)()||"",t=`${n.ip}/fdb/${n.network}/${n.db}/query`,s={};(0,r.hasApiKey)(n.apiKey)&&(s={authorization:`Bearer ${n.apiKey}`}),(0,r.sendReq)(t,e,o,s).then((e=>i(e))).catch((e=>console.log("error: ",e)))}})),d=t.commands.registerCommand("extension.submitHistoryQuery",(()=>{if(0!==Object.keys(n).length){let e=(0,r.getCurrentSelection)()||"",t=`${n.ip}/fdb/${n.network}/${n.db}/history`,s={};return(0,r.hasApiKey)(n.apiKey)&&(s={authorization:`Bearer ${n.apiKey}`}),(0,r.sendReq)(t,e,o,s).then((e=>i(e))).catch((e=>console.log("error: ",e)))}t.window.showErrorMessage("Please connect to a database first. `Fluree: Set Config`")})),h=t.commands.registerCommand("extension.submitBlockQuery",(()=>{if(0!==Object.keys(n).length){let e=(0,r.getCurrentSelection)()||"",t=`${n.ip}/fdb/${n.network}/${n.db}/block`,s={};return(0,r.hasApiKey)(n.apiKey)&&(s={authorization:`Bearer ${n.apiKey}`}),(0,r.sendReq)(t,e,o,s).then((e=>i(e))).catch((e=>console.log("error: ",e)))}t.window.showErrorMessage("Please connect to a database first. `Fluree: Set Config`")})),p=t.commands.registerCommand("extension.submitMultiQuery",(()=>{if(0!==Object.keys(n).length){let e=(0,r.getCurrentSelection)()||"",t=`${n.ip}/fdb/${n.network}/${n.db}/multi-query`,s={};return(0,r.hasApiKey)(n.apiKey)&&(s={authorization:`Bearer ${n.apiKey}`}),(0,r.sendReq)(t,e,o,s).then((e=>i(e))).catch((e=>console.log("error: ",e)))}t.window.showErrorMessage("Please connect to a database first. `Fluree: Set Config`")})),g=t.commands.registerCommand("extension.submitQueryWith",(()=>{if(0!==Object.keys(n).length){let e=(0,r.getCurrentSelection)()||"",t=`${n.ip}/fdb/${n.network}/${n.db}/query-with`,s={};return(0,r.hasApiKey)(n.apiKey)&&(s={authorization:`Bearer ${n.apiKey}`}),(0,r.sendReq)(t,e,o,s).then((e=>i(e))).catch((e=>console.log("error: ",e)))}t.window.showErrorMessage("Please connect to a database first. `Fluree: Set Config`")})),f=t.commands.registerCommand("extension.submitGenFlakes",(()=>{if(0!==Object.keys(n).length){let e=(0,r.getCurrentSelection)()||"",t=`${n.ip}/fdb/${n.network}/${n.db}/gen-flakes`,s={};return(0,r.hasApiKey)(n.apiKey)&&(s={authorization:`Bearer ${n.apiKey}`}),(0,r.sendReq)(t,e,o,s).then((e=>i(e))).catch((e=>console.log("error: ",e)))}t.window.showErrorMessage("Please connect to a database first. `Fluree: Set Config`")})),w=t.commands.registerCommand("extension.submitTestTransactWith",(()=>{if(0!==Object.keys(n).length){let e=(0,r.getCurrentSelection)()||"",t=`${n.ip}/fdb/${n.network}/${n.db}/test-transact-with`,s={};return(0,r.hasApiKey)(n.apiKey)&&(s={authorization:`Bearer ${n.apiKey}`}),(0,r.sendReq)(t,e,o,s).then((e=>i(e))).catch((e=>console.log("error: ",e)))}t.window.showErrorMessage("Please connect to a database first. `Fluree: Set Config`")})),m=t.commands.registerCommand("extension.getMigrations",(()=>{if(0!==Object.keys(n).length){let e=`${n.ip}/fdb/${n.network}/${n.db}`,t={};return(0,r.hasApiKey)(n.apiKey)&&(t={authorization:`Bearer ${n.apiKey}`}),(0,r.fetchMigrations)(e,o,t)}t.window.showErrorMessage("Please connect to a database first. `Fluree: Set Config`")}));e.subscriptions.push(s,a,c,l,u,d,h,p,g,f,w,m)},e.deactivate=function(){}})(),module.exports=o})();